close all;clear variables;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Definition des constantes %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%fid = fopen('listes.txt','w');liste_fichiers = dir('formes/*');Nb_fichiers = length(liste_fichiers);for num = 1:Nb_fichiers-2  Flag_exception_cc = 0; %Flag permettant de détecter la présence d'un carre_creux  Flag_exception_pb_photo = 0; % Flag permettant de détecter un problème lie a la photo  image_ref = [[128/255,0,128/255];[255/255,0,255/255];[0,255/255,0];[255/255,255/255,0];[255/255,128/255,0]];  image_ref1 = zeros(5,1,3);  image_ref1(:,:,1) = image_ref(:,1);  image_ref1(:,:,2) = image_ref(:,2);  image_ref1(:,:,3) = image_ref(:,3);  image_ref_hsv = rgb2hsv(image_ref1);  %%%%%%%%%%%%%%%%%%%%%%%%%%  % Definition des données %  %%%%%%%%%%%%%%%%%%%%%%%%%%  %Importation de l'image en couleurs  Im_color = im2double(imread(['formes/',liste_fichiers(num+2).name]));  %Conversion en image noir-blanc  Im_nb = rgb2gray(Im_color);  %Determination des dimensions de l'image  [h,w] = size(Im_nb);  %Determination des seuils  maxi_im = max(max(Im_nb));  mini_im = min(min(Im_nb));  Seuil_up = (maxi_im + mini_im) *3/ 4;  Seuil_down = (maxi_im + mini_im)* 1/ 4;  %%%%%%%%%%%%%  % Seuillage %  %%%%%%%%%%%%%  Im_dil3lvl = Seuillage3niveaux(Im_nb, Seuil_up, Seuil_down);  %%%%%%%%%%%%%%%%%%%%%%%%%%  % Extraction de la forme %  %%%%%%%%%%%%%%%%%%%%%%%%%%  Marqueur = RechercheForme(Im_dil3lvl);  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  % Extraction de l'imagette centrale contenant la forme et la couleur %  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  [imagette_col, marq_extr, Flag_exception_cc, Flag_exception_pb_photo] = ExtractionImagette(Im_color, Marqueur, Im_dil3lvl);  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  % Détermination de la couleur %  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  valeur_milieue = Im_dil3lvl(floor(h/2),floor(w/2))+0.1;  [h1,w1,trois1] = size(imagette_col);  %Test si on a capté la couleur ou la forme  if (valeur_milieue-0.1 == 0) %On est dans la forme        %Dilatation du marqueur    st_couleur = strel('square', 40);    test = zeros(h1,w1,trois1);    marq_extr = imdilate(marq_extr,st_couleur);    test(:,:,1) = marq_extr;    test(:,:,2) = marq_extr;    test(:,:,3) = marq_extr;    %Isolation de la couleur    imagette_coul = imagette_col.*(1-test);    couleur = DeterminationCouleur(imagette_coul)      elseif (valeur_milieue - 0.1 == 0.5) %On est dans la couleur        aretirer = ones(h1,w1,3);    aretirer(40:h1-40, 40:w1-40,:) = zeros(h1-79, w1-79,3);    imagette_coul = imagette_col .* aretirer;    couleur = DeterminationCouleur(imagette_coul)     else         Flag_exception_pb_photo = 1;      end  %%%%%%%%%%%%%%%%%%%%%%%%%  % Detection de la forme %  %%%%%%%%%%%%%%%%%%%%%%%%%  Forme = DeterminationForme(imagette_col, Seuil_down)  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  % Ecriture des resultats dans un fichier texte %  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  fprintf(fid, [Forme, ',', couleur,'\n']);endfclose(fid);  %%%%%%%%%%%%%%%%%%%%%%%%%%%  % Affichage des resultats %  %%%%%%%%%%%%%%%%%%%%%%%%%%%%   %Visualisation de l'image coloree%   figure(1)%   subplot(121)%   imshow(Im_color)%   title('Image initiale')% %   %Visualisation de l'image et noir et blanc%   subplot(122)%   imshow(Im_nb)%   title('Image en nuances de gris')% %   %Visualisation des résultats du seuillage%   figure(2)%   subplot(224)%   imshow(Im_dil3lvl)%   title('Dilatation du seuillage a 3 niveaux')% %   %Visualisation du marqueur%   figure(3)%   imshow(Marqueur);%   title('Marqueur de l''image')% %   %Visualisation de l'imagette extraite%   figure(4)%   imshow(imagette_col)%   title('Imagette extraite')% %   %Visualisation de la détection de la couleur%   figure(5)%   subplot(221)%   imshow(marq_extr);%   title('Marqueur extrait du marqueur global')  